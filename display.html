<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tampilan TV - Quiz ESDM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gradient-to-br from-amber-600 to-amber-900 min-h-screen p-8">
    <!-- Header -->
    <div class="bg-white rounded-2xl shadow-2xl mb-8 p-8">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <div class="bg-amber-600 rounded-full w-20 h-20 flex items-center justify-center">
                    <i class="fas fa-bolt text-white text-4xl"></i>
                </div>
                <div>
                    <h1 class="text-4xl font-bold text-gray-800">Quiz ESDM</h1>
                    <p class="text-gray-600 text-lg">Dinas ESDM Provinsi Jambi</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-gray-600">Peserta:</p>
                <p class="text-3xl font-bold text-amber-600" id="participantName">-</p>
            </div>
        </div>
    </div>

    <!-- Waiting Screen -->
    <div id="waitingScreen" class="text-center">
        <div class="bg-white rounded-2xl shadow-2xl p-16">
            <i class="fas fa-hourglass-half text-amber-600 text-9xl mb-8 animate-pulse"></i>
            <h2 class="text-5xl font-bold text-gray-800 mb-4">Menunggu Quiz Dimulai...</h2>
            <p class="text-2xl text-gray-600">Silakan scan QR Code untuk bergabung</p>
        </div>
    </div>

    <!-- Question Screen -->
    <div id="questionScreen" class="hidden">
        <!-- Progress and Info -->
        <div class="bg-white rounded-2xl shadow-2xl p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <p class="text-gray-600 text-lg">Pertanyaan</p>
                    <p class="text-3xl font-bold text-gray-800">
                        <span id="currentQuestionNum">1</span> / <span id="totalQuestions">10</span>
                    </p>
                </div>
                <div class="text-right">
                    <p class="text-gray-600 text-lg">Skor Saat Ini</p>
                    <p class="text-5xl font-bold text-amber-600" id="currentScore">0</p>
                </div>
            </div>
            <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
                <div id="progressBar" class="bg-amber-600 h-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <!-- Question Card -->
        <div class="bg-white rounded-2xl shadow-2xl p-12 mb-8">
            <div class="mb-8">
                <div class="inline-block bg-amber-100 text-amber-700 px-6 py-2 rounded-full text-xl font-semibold mb-6">
                    <i class="fas fa-question-circle mr-2"></i>
                    Pertanyaan
                </div>
            </div>
            <h2 class="text-5xl font-bold text-gray-800 mb-12 leading-tight" id="questionText">-</h2>

            <!-- Options Grid -->
            <div class="grid grid-cols-1 gap-6" id="optionsContainer">
                <!-- Options will be inserted here -->
            </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-between">
            <button onclick="previousQuestion()" id="prevBtn" class="bg-white hover:bg-gray-100 text-gray-800 font-bold py-4 px-8 rounded-xl shadow-lg transition duration-300 text-xl">
                <i class="fas fa-arrow-left mr-2"></i>
                Sebelumnya
            </button>
            <button onclick="nextQuestion()" id="nextBtn" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg transition duration-300 text-xl">
                Selanjutnya
                <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-16 text-center">
            <i class="fas fa-trophy text-amber-600 text-9xl mb-8"></i>
            <h2 class="text-6xl font-bold text-gray-800 mb-8">Quiz Selesai!</h2>
            
            <div class="bg-gradient-to-br from-amber-500 to-amber-700 text-white rounded-2xl p-12 mb-8">
                <p class="text-3xl mb-4">Skor Akhir</p>
                <p class="text-9xl font-bold" id="finalScore">0</p>
            </div>

            <div class="grid grid-cols-3 gap-6 mb-8">
                <div class="bg-blue-50 rounded-xl p-6">
                    <p class="text-gray-600 text-xl mb-2">Total Soal</p>
                    <p class="text-4xl font-bold text-blue-600" id="totalQuestionsResult">0</p>
                </div>
                <div class="bg-green-50 rounded-xl p-6">
                    <p class="text-gray-600 text-xl mb-2">Benar</p>
                    <p class="text-4xl font-bold text-green-600" id="correctAnswers">0</p>
                </div>
                <div class="bg-red-50 rounded-xl p-6">
                    <p class="text-gray-600 text-xl mb-2">Salah</p>
                    <p class="text-4xl font-bold text-red-600" id="wrongAnswers">0</p>
                </div>
            </div>

            <p class="text-3xl text-gray-600 mb-8">Terima kasih telah mengikuti quiz!</p>
            
            <button onclick="backToWaiting()" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-4 px-12 rounded-xl shadow-lg transition duration-300 text-2xl">
                <i class="fas fa-home mr-2"></i>
                Kembali
            </button>
        </div>
    </div>

    <script src="questions.js"></script>
    <script src="app.js"></script>
    <script>
        let activeParticipant = null;
        let currentQuestionIndex = 0;

        const waitingScreen = document.getElementById('waitingScreen');
        const questionScreen = document.getElementById('questionScreen');
        const resultScreen = document.getElementById('resultScreen');

        async function updateDisplay() {
            const activeId = localStorage.getItem('activeParticipantId');
            if (!activeId) {
                showWaitingScreen();
                return;
            }

            const participants = await QuizApp.getParticipants();
            const participant = participants.find(p => p.id === parseInt(activeId));

            if (!participant) {
                showWaitingScreen();
                return;
            }

            activeParticipant = participant;
            document.getElementById('participantName').textContent = participant.nama;

            if (participant.status === 'finished') {
                showResultScreen();
            } else if (participant.status === 'playing' && participant.questions) {
                showQuestionScreen();
            } else {
                showWaitingScreen();
            }
        }

        function showWaitingScreen() {
            waitingScreen.classList.remove('hidden');
            questionScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
        }

        function showQuestionScreen() {
            waitingScreen.classList.add('hidden');
            questionScreen.classList.remove('hidden');
            resultScreen.classList.add('hidden');

            if (!activeParticipant || !activeParticipant.questions) return;

            currentQuestionIndex = activeParticipant.currentQuestion || 0;
            const questions = activeParticipant.questions;
            const currentQ = questions[currentQuestionIndex];

            document.getElementById('currentQuestionNum').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQuestions').textContent = questions.length;
            document.getElementById('currentScore').textContent = activeParticipant.score || 0;

            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            document.getElementById('questionText').textContent = currentQ.question;

            // Display options
            const optionsContainer = document.getElementById('optionsContainer');
            const labels = ['A', 'B', 'C', 'D'];
            
            optionsContainer.innerHTML = currentQ.options.map((option, index) => {
                const answer = activeParticipant.answers?.find(a => a.questionIndex === currentQuestionIndex);
                let optionClass = 'bg-gray-50 border-4 border-gray-300';
                let icon = '';

                if (answer) {
                    if (index === currentQ.correct) {
                        optionClass = 'bg-green-100 border-4 border-green-500';
                        icon = '<i class="fas fa-check-circle text-green-500 text-4xl"></i>';
                    } else if (index === answer.selected && !answer.isCorrect) {
                        optionClass = 'bg-red-100 border-4 border-red-500';
                        icon = '<i class="fas fa-times-circle text-red-500 text-4xl"></i>';
                    }
                }

                return `
                    <div class="${optionClass} rounded-xl p-8 transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-6">
                                <div class="bg-amber-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-3xl font-bold flex-shrink-0">
                                    ${labels[index]}
                                </div>
                                <p class="text-3xl font-semibold text-gray-800">${option}</p>
                            </div>
                            <div>
                                ${icon}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Update button states
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').textContent = currentQuestionIndex === questions.length - 1 
                ? 'Selesai' 
                : 'Selanjutnya';
        }

        function showResultScreen() {
            waitingScreen.classList.add('hidden');
            questionScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');

            if (!activeParticipant) return;

            const totalQuestions = activeParticipant.questions?.length || 0;
            const score = activeParticipant.score || 0;
            const wrong = totalQuestions - score;

            document.getElementById('finalScore').textContent = score;
            document.getElementById('totalQuestionsResult').textContent = totalQuestions;
            document.getElementById('correctAnswers').textContent = score;
            document.getElementById('wrongAnswers').textContent = wrong;
        }

        function nextQuestion() {
            if (!activeParticipant || !activeParticipant.questions) return;

            if (currentQuestionIndex < activeParticipant.questions.length - 1) {
                currentQuestionIndex++;
                updateParticipantQuestion(currentQuestionIndex);
            } else {
                finishQuiz();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                updateParticipantQuestion(currentQuestionIndex);
            }
        }

        async function updateParticipantQuestion(questionIndex) {
            const participants = await QuizApp.getParticipants();
            const pIndex = participants.findIndex(p => p.id === activeParticipant.id);

            if (pIndex !== -1) {
                participants[pIndex].currentQuestion = questionIndex;
                await QuizApp.saveParticipants(participants);
            }

            updateDisplay();
        }

        async function finishQuiz() {
            const participants = await QuizApp.getParticipants();
            const pIndex = participants.findIndex(p => p.id === activeParticipant.id);

            if (pIndex !== -1) {
                participants[pIndex].status = 'finished';
                participants[pIndex].finishedAt = new Date().toISOString();
                await QuizApp.saveParticipants(participants);
            }

            updateDisplay();
        }

        function backToWaiting() {
            localStorage.removeItem('activeParticipantId');
            updateDisplay();
        }

        // Auto update every second
        setInterval(updateDisplay, 1000);

        // Initial load
        updateDisplay();

        // Listen to storage events
        window.addEventListener('storage', updateDisplay);
    </script>
</body>
</html>